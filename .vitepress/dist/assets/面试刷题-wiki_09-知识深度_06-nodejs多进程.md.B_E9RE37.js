import{_ as e,c as o,o as a,a1 as d}from"./chunks/framework.BwTyoF0R.js";const m=JSON.parse('{"title":"nodejs 多进程","description":"","frontmatter":{},"headers":[],"relativePath":"面试刷题-wiki/09-知识深度/06-nodejs多进程.md","filePath":"面试刷题-wiki/09-知识深度/06-nodejs多进程.md"}'),r={name:"面试刷题-wiki/09-知识深度/06-nodejs多进程.md"},s=d('<h1 id="nodejs-多进程" tabindex="-1">nodejs 多进程 <a class="header-anchor" href="#nodejs-多进程" aria-label="Permalink to &quot;nodejs 多进程&quot;">​</a></h1><h2 id="题目" tabindex="-1">题目 <a class="header-anchor" href="#题目" aria-label="Permalink to &quot;题目&quot;">​</a></h2><p>nodejs 如何开启一个进程，进程之间如何通讯</p><h2 id="进程-process-和线程-thread" tabindex="-1">进程 process 和线程 thread <a class="header-anchor" href="#进程-process-和线程-thread" aria-label="Permalink to &quot;进程 process 和线程 thread&quot;">​</a></h2><p>进程，是操作系统进行资源调度和分配的基本单位，每个进程都拥有自己独立的内存区域（参考“堆栈模型”）。 一个进程无法直接访问另一个进程的内存数据，除非通过合法的进程通讯。</p><p>执行一个 nodejs 文件，即开启了一个进程，可以通过 <code>process.pid</code> 查看进程 id 。</p><p>线程，是操作系统进行运算调度的最小单位，线程是附属于进程的。一个进程可以包含多个线程（至少一个），多线程之间可共用进程的内存数据。<br> 如操作系统是一个工厂，进程就是一个车间，线程就是一个一个的工人。</p><p>JS 是单线程的，即执行 JS 时启动一个进程（如 JS 引擎，nodejs 等），然后其中再开启一个线程来执行。<br> 虽然单线程，JS 是基于事件驱动的，它不会阻塞执行，适合高并发的场景。</p><h2 id="为何需要多进程" tabindex="-1">为何需要多进程 <a class="header-anchor" href="#为何需要多进程" aria-label="Permalink to &quot;为何需要多进程&quot;">​</a></h2><p>现代服务器都是多核 CPU ，适合同时处理多进程。即，一个进程无法充分利用 CPU 性能，进程数要等于 CPU 核数。</p><p>服务器一般内存比较大，但操作系统对于一个进程的内存分配是有上限的（2G），所以多进程才能充分利用服务器内存。</p><h2 id="nodejs-开启多进程" tabindex="-1">nodejs 开启多进程 <a class="header-anchor" href="#nodejs-开启多进程" aria-label="Permalink to &quot;nodejs 开启多进程&quot;">​</a></h2><p><code>child_process.fork</code> 可开启子进程执行单独的计算（源码参考 process-fork.js）</p><ul><li><code>fork(&#39;xxx.js&#39;)</code> 开启一个子进程</li><li>使用 <code>send</code> 发送信息，使用 <code>on</code> 接收信息</li></ul><p><code>cluster.fork</code> 可针对当前代码，开启多个进程来执行（源码参考 cluster.js）</p><h2 id="答案" tabindex="-1">答案 <a class="header-anchor" href="#答案" aria-label="Permalink to &quot;答案&quot;">​</a></h2><ul><li>可使用 <code>child_process.fork</code> 和 <code>cluster.fork</code> 开启子进程</li><li>使用 <code>send</code> <code>on</code> 传递消息</li></ul><h2 id="扩展-使用-pm2" tabindex="-1">扩展：使用 PM2 <a class="header-anchor" href="#扩展-使用-pm2" aria-label="Permalink to &quot;扩展：使用 PM2&quot;">​</a></h2><p>nodejs 服务开启多进程、进程守护，可使用 <a href="https://www.npmjs.com/package/pm2" target="_blank" rel="noreferrer">pm2</a> ，不需要自己写。代码参考 koa2-code</p><ul><li>全局安装 pm2 <code>yarn global add pm2</code></li><li>增加 pm2 配置文件</li><li>修改 package.json scripts</li></ul>',20),c=[s];function t(i,l,n,p,h,_){return a(),o("div",null,c)}const f=e(r,[["render",t]]);export{m as __pageData,f as default};
